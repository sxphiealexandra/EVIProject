<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tier√ºbersicht</title>
  <link rel="stylesheet" href="css/styles.css">
  <link rel="stylesheet" href="css/tablestyles.css">
  
</head>
<body>
  <div class="hero">
    <div class="overlay">
      <div class="page-title">
        <img src="/img/LogoWildLifeObservation.png" alt="Logo">
        <h1>Tabelle</h1>
      </div>
      <div class="table-container">
        <h2>Alle Tiere</h2>
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>Geschlecht</th>
              <th>Alter</th>
              <th>Gr√∂√üe</th>
              <th>Gewicht</th>
              <th>Gattung</th>
              <th>Lateinisch</th>
              <th>Ort</th>
              <th>Datum</th>
              <th>Aktualisieren</th>
              <th>L√∂schen</th>
            </tr>
          </thead>
          <tbody id="animalTableBody">
            <!-- Wird dynamisch per JS gef√ºllt -->
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    async function loadAnimals() {
      try {
        const response = await fetch("/animal");
        const animals = await response.json();

        const tbody = document.getElementById("animalTableBody");

        for (const animal of animals) {
          // Hole Full-Daten
          const res = await fetch(`/animal-full/${animal.id}`);
          if (!res.ok) continue;
          const full = await res.json();

          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${animal.id}</td>
            <td>${animal.gender}</td>
            <td>${animal.estimatedAge}</td>
            <td>${animal.estimatedSize}</td>
            <td>${animal.estimatedWeight}</td>
            <td>${full.designation || "-"}</td>
            <td>${full.latinDesignation || "-"}</td>
            <td>${full.locationShortTitle || "-"}</td>
            <td>${full.date || "-"}</td>
            <td class="action-buttons">
              <a href="edit-loader.html?id=${animal.id}" title="Bearbeiten">‚úé</a>
            </td>
            <td class="action-buttons">
              <button onclick="deleteAnimal(${animal.id})" title="L√∂schen">üóëÔ∏è</button>
            </td>
          `;
          tbody.appendChild(row);
        }
      } catch (err) {
        console.error("‚ùå Fehler beim Laden der Tabelle:", err);
        alert("‚ö†Ô∏è Fehler beim Laden der Tierdaten.");
      }
    }

    async function deleteAnimal(id) {
      const confirmDelete = confirm(`M√∂chtest du Tier mit ID ${id} wirklich l√∂schen?`);
      if (!confirmDelete) return;

      try {
        const res = await fetch(`/animal-full/${id}`, {
          method: "DELETE"
        });

        if (res.ok) {
          alert("‚úÖ Tier gel√∂scht.");
          location.reload(); // Seite neu laden, um Zeile zu entfernen
        } else {
          const msg = await res.text();
          alert("‚ùå Fehler beim L√∂schen: " + msg);
        }
      } catch (err) {
        alert("‚ùå Netzwerkfehler: " + err.message);
      }
    }

    // Lade Tiere beim Start
    loadAnimals();
  </script>
</body>
</html>
